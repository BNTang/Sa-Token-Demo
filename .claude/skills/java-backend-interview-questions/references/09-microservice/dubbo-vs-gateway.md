# Dubbo 与 Spring Cloud Gateway 区别

> 分类: 微服务 | 难度: ⭐⭐⭐ | 频率: 中频

---

## 一、核心区别

**这两个不是同类产品，不能直接对比！**

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│                     Dubbo vs Spring Cloud Gateway                                 │
├─────────────────┬───────────────────────────┬────────────────────────────────────┤
│                 │        Dubbo              │     Spring Cloud Gateway           │
├─────────────────┼───────────────────────────┼────────────────────────────────────┤
│   定位          │   RPC 服务框架             │   API 网关                         │
│   通信协议      │   Dubbo协议(TCP)、gRPC等   │   HTTP/HTTPS                       │
│   使用场景      │   服务间内部调用           │   统一入口、流量管控               │
│   调用方式      │   像本地方法一样调用       │   HTTP 请求转发                    │
│   性能          │   高(二进制协议)           │   相对较低(HTTP开销)               │
│   所属生态      │   Apache Dubbo             │   Spring Cloud                     │
└─────────────────┴───────────────────────────┴────────────────────────────────────┘
```

---

## 二、Dubbo 详解

### 2.1 什么是 Dubbo

Dubbo 是阿里开源的**高性能 RPC 框架**，用于微服务之间的通信。

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│                           Dubbo 架构                                              │
├──────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│     ┌──────────────┐                          ┌──────────────┐                   │
│     │   Consumer   │                          │   Provider   │                   │
│     │   (调用方)    │                          │   (服务方)   │                   │
│     └───────┬──────┘                          └──────┬───────┘                   │
│             │ 3.调用                                  │ 1.注册                    │
│             │ (RPC)                                   │                          │
│             ↓                                         ↓                          │
│     ┌───────────────────────────────────────────────────────────┐                │
│     │                    Registry (Nacos/Zookeeper)              │                │
│     │                       注册中心                              │                │
│     └───────────────────────────────────────────────────────────┘                │
│             │ 2.订阅                                  │                          │
│             ↓                                         │                          │
│     ┌──────────────┐                                  │                          │
│     │   Consumer   │←─────────────────────────────────┘                          │
│     │  获取服务列表 │                                                            │
│     └──────────────┘                                                             │
│                                                                                  │
└──────────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 Dubbo 代码示例

```java
// 1. 定义接口
public interface UserService {
    User getById(Long id);
}

// 2. 服务提供者
@DubboService
public class UserServiceImpl implements UserService {
    @Override
    public User getById(Long id) {
        return userMapper.selectById(id);
    }
}

// 3. 服务消费者
@Service
public class OrderService {
    
    @DubboReference
    private UserService userService;  // 像本地服务一样注入
    
    public Order createOrder(Long userId) {
        User user = userService.getById(userId);  // RPC调用，像本地方法一样
        // ...
    }
}
```

---

## 三、Spring Cloud Gateway 详解

### 3.1 什么是 API 网关

API 网关是系统的**统一入口**，处理所有外部请求。

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│                      Spring Cloud Gateway 架构                                    │
├──────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│   外部请求 (HTTP)                                                                │
│         │                                                                        │
│         ↓                                                                        │
│   ┌──────────────────────────────────────────────────────────────┐               │
│   │               Spring Cloud Gateway                           │               │
│   ├──────────────────────────────────────────────────────────────┤               │
│   │  • 路由转发 (Route)                                          │               │
│   │  • 负载均衡 (LoadBalancer)                                   │               │
│   │  • 限流熔断 (RateLimiter/CircuitBreaker)                     │               │
│   │  • 认证鉴权 (Authentication)                                 │               │
│   │  • 日志监控 (Logging/Metrics)                                │               │
│   └──────────────────────────────────────────────────────────────┘               │
│         │                                                                        │
│    ┌────┴────┬───────────┬───────────┐                                          │
│    ↓         ↓           ↓           ↓                                          │
│ ┌──────┐ ┌──────┐   ┌──────┐   ┌──────┐                                         │
│ │用户服务│ │订单服务│   │商品服务│   │支付服务│                                   │
│ └──────┘ └──────┘   └──────┘   └──────┘                                         │
│                                                                                  │
└──────────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Gateway 配置示例

```yaml
# application.yml
spring:
  cloud:
    gateway:
      routes:
        # 用户服务路由
        - id: user-service
          uri: lb://user-service
          predicates:
            - Path=/api/user/**
          filters:
            - StripPrefix=1
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 100
                redis-rate-limiter.burstCapacity: 200
        
        # 订单服务路由
        - id: order-service
          uri: lb://order-service
          predicates:
            - Path=/api/order/**
          filters:
            - StripPrefix=1
```

### 3.3 自定义过滤器

```java
/**
 * 全局认证过滤器
 */
@Component
public class AuthGlobalFilter implements GlobalFilter, Ordered {
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        String token = exchange.getRequest().getHeaders().getFirst("Authorization");
        
        if (token == null || !validateToken(token)) {
            exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);
            return exchange.getResponse().setComplete();
        }
        
        return chain.filter(exchange);
    }
    
    @Override
    public int getOrder() {
        return -100; // 优先级
    }
}
```

---

## 四、实际架构中的关系

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│                      微服务架构中的位置关系                                        │
├──────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│   ┌─────────────────────────────────────────────────────────────────────────┐    │
│   │                         外部流量入口                                     │    │
│   │                      (App/Web/第三方)                                    │    │
│   └───────────────────────────────┬─────────────────────────────────────────┘    │
│                                   │ HTTP                                         │
│                                   ↓                                              │
│   ┌─────────────────────────────────────────────────────────────────────────┐    │
│   │               Spring Cloud Gateway (API网关)                             │    │
│   │           统一入口、认证、限流、路由                                      │    │
│   └───────────────────────────────┬─────────────────────────────────────────┘    │
│                                   │ HTTP                                         │
│        ┌────────────────────┬─────┴─────┬───────────────────┐                    │
│        ↓                    ↓           ↓                   ↓                    │
│   ┌─────────┐         ┌─────────┐  ┌─────────┐        ┌─────────┐               │
│   │用户服务  │ ←Dubbo→ │订单服务  │  │商品服务  │←Dubbo→ │库存服务  │               │
│   └─────────┘   RPC   └─────────┘  └─────────┘  RPC   └─────────┘               │
│                                                                                  │
│   说明:                                                                          │
│   • Gateway: 处理外部HTTP请求，路由到对应服务                                     │
│   • Dubbo: 服务间内部RPC调用(高性能)                                             │
│                                                                                  │
└──────────────────────────────────────────────────────────────────────────────────┘
```

---

## 五、详细对比

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│                        功能与场景对比                                             │
├─────────────────┬─────────────────────────┬──────────────────────────────────────┤
│   对比维度      │         Dubbo           │       Spring Cloud Gateway           │
├─────────────────┼─────────────────────────┼──────────────────────────────────────┤
│   核心功能      │  RPC远程调用             │  HTTP请求路由转发                    │
│   通信协议      │  Dubbo/Triple/gRPC       │  HTTP/HTTPS/WebSocket                │
│   序列化        │  Hessian2/Protobuf等     │  JSON为主                            │
│   服务发现      │  ✅ 内置                 │  ✅ 依赖注册中心                     │
│   负载均衡      │  ✅ 客户端负载均衡       │  ✅ 服务端负载均衡                   │
│   熔断降级      │  ✅ 内置                 │  ✅ 集成 Sentinel/Resilience4j       │
│   限流          │  ✅ 内置                 │  ✅ 内置                             │
│   认证鉴权      │  ❌ 需自己实现           │  ✅ 核心功能                         │
│   协议转换      │  ❌                      │  ✅ HTTP↔内部服务                    │
│   日志监控      │  ✅ 内置                 │  ✅ 内置                             │
│   使用场景      │  内部服务间调用          │  统一外部入口                        │
└─────────────────┴─────────────────────────┴──────────────────────────────────────┘
```

---

## 六、面试回答

### 30秒版本

> 这两个**不是同类产品**：
> - **Dubbo** 是 RPC 框架，用于**服务间内部调用**，采用 TCP 二进制协议，性能高
> - **Spring Cloud Gateway** 是 API 网关，作为系统**统一入口**，处理外部 HTTP 请求，负责路由、认证、限流
>
> 实际架构中两者配合使用：Gateway 接收外部请求路由到服务，服务间调用用 Dubbo。

### 1分钟版本

> Dubbo 和 Spring Cloud Gateway 是**不同层面**的组件：
>
> **Dubbo（RPC 框架）：**
> - 定位：服务间内部高性能通信
> - 协议：Dubbo/Triple 协议（TCP），二进制序列化
> - 使用方式：像本地方法一样调用远程服务
> - 适用场景：微服务内部调用，追求高性能
>
> **Spring Cloud Gateway（API 网关）：**
> - 定位：系统统一入口
> - 协议：HTTP/HTTPS
> - 核心功能：路由转发、认证鉴权、限流熔断、日志监控
> - 适用场景：暴露 API 给外部（App/Web/第三方）
>
> **实际架构**：Gateway 负责接收外部请求并路由到相应服务，服务之间的调用则使用 Dubbo 以获得更好的性能。

---

## 七、补充：如果要对比同类产品

### 7.1 RPC 框架对比

| 框架 | 公司 | 协议 | 特点 |
|------|------|------|------|
| **Dubbo** | 阿里/Apache | Dubbo/Triple | 生态完善，功能全面 |
| **gRPC** | Google | HTTP/2 + Protobuf | 跨语言，高性能 |
| **Feign** | Netflix | HTTP + JSON | 简单易用，Spring Cloud 集成好 |
| **Thrift** | Facebook/Apache | 自定义 | 跨语言 |

### 7.2 API 网关对比

| 网关 | 语言 | 特点 |
|------|------|------|
| **Spring Cloud Gateway** | Java | Spring 生态，响应式编程 |
| **Kong** | Lua/Go | 功能强大，插件丰富 |
| **APISIX** | Lua | 高性能，动态配置 |
| **Nginx** | C | 高性能，静态配置 |
| **Zuul 2** | Java | Netflix 出品，异步非阻塞 |
