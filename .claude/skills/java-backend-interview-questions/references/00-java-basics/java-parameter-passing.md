# Java 中的参数传递是按值还是按引用？

## 核心结论

```
┌─────────────────────────────────────────────────────────────┐
│                    Java 参数传递                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   ┌─────────────────────────────────────────────────────┐  │
│   │                                                     │  │
│   │        Java 永远是按值传递 (Pass by Value)          │  │
│   │                                                     │  │
│   └─────────────────────────────────────────────────────┘  │
│                                                             │
│   • 基本类型: 传递的是值的拷贝                              │
│   • 引用类型: 传递的是引用地址的拷贝（不是对象本身）        │
│                                                             │
│   重点: 引用类型传的也是值，只不过这个值是"地址"            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 基本类型参数传递

```java
public class PrimitiveDemo {
    public static void main(String[] args) {
        int num = 10;
        System.out.println("调用前: " + num);  // 10
        
        changeValue(num);
        
        System.out.println("调用后: " + num);  // 10 (未改变！)
    }
    
    public static void changeValue(int x) {
        x = 100;  // 只修改了拷贝，不影响原值
    }
}
```

```
┌─────────────────────────────────────────────────────────────┐
│                    基本类型传递                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   调用前:                                                    │
│   ┌─────────────────┐                                       │
│   │   main 栈帧     │                                       │
│   │   num = 10      │                                       │
│   └─────────────────┘                                       │
│                                                             │
│   调用时 (拷贝值):                                           │
│   ┌─────────────────┐     ┌─────────────────┐              │
│   │   main 栈帧     │     │ changeValue栈帧 │              │
│   │   num = 10      │     │   x = 10        │  拷贝        │
│   └─────────────────┘     └─────────────────┘              │
│                                                             │
│   修改 x 后:                                                 │
│   ┌─────────────────┐     ┌─────────────────┐              │
│   │   main 栈帧     │     │ changeValue栈帧 │              │
│   │   num = 10      │     │   x = 100       │  互不影响    │
│   └─────────────────┘     └─────────────────┘              │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 引用类型参数传递

### 情况1: 修改对象属性

```java
public class ReferenceDemo1 {
    public static void main(String[] args) {
        User user = new User("Tom");
        System.out.println("调用前: " + user.name);  // Tom
        
        changeName(user);
        
        System.out.println("调用后: " + user.name);  // Jerry (改变了！)
    }
    
    public static void changeName(User u) {
        u.name = "Jerry";  // 通过地址修改堆中对象
    }
}
```

```
┌─────────────────────────────────────────────────────────────┐
│                    修改对象属性                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   调用时:                                                    │
│   ┌─────────────────┐     ┌─────────────────┐              │
│   │   main 栈帧     │     │ changeName栈帧  │              │
│   │   user = 0x100  │     │   u = 0x100     │  地址拷贝    │
│   └────────┬────────┘     └────────┬────────┘              │
│            │                       │                        │
│            │      ┌────────────────┘                        │
│            │      │                                         │
│            ▼      ▼                                         │
│       ┌─────────────────┐                                   │
│       │  堆: User对象    │  两个引用指向同一个对象          │
│       │  name = "Jerry" │  ← 被修改了                       │
│       │  地址: 0x100    │                                   │
│       └─────────────────┘                                   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 情况2: 让引用指向新对象

```java
public class ReferenceDemo2 {
    public static void main(String[] args) {
        User user = new User("Tom");
        System.out.println("调用前: " + user.name);  // Tom
        
        changeUser(user);
        
        System.out.println("调用后: " + user.name);  // Tom (没变！)
    }
    
    public static void changeUser(User u) {
        u = new User("Jerry");  // u 指向新对象，不影响 user
    }
}
```

```
┌─────────────────────────────────────────────────────────────┐
│                    改变引用指向                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   调用前:                                                    │
│   ┌─────────────────┐     ┌─────────────────┐              │
│   │   main 栈帧     │     │ changeUser栈帧  │              │
│   │   user = 0x100  │     │   u = 0x100     │  地址拷贝    │
│   └────────┬────────┘     └────────┬────────┘              │
│            │                       │                        │
│            ▼                       ▼                        │
│       ┌─────────────────┐                                   │
│       │  堆: User对象    │                                   │
│       │  name = "Tom"   │                                   │
│       │  地址: 0x100    │                                   │
│       └─────────────────┘                                   │
│                                                             │
│   u = new User("Jerry") 后:                                 │
│   ┌─────────────────┐     ┌─────────────────┐              │
│   │   main 栈帧     │     │ changeUser栈帧  │              │
│   │   user = 0x100  │     │   u = 0x200     │  u 变了      │
│   └────────┬────────┘     └────────┬────────┘              │
│            │                       │                        │
│            ▼                       ▼                        │
│   ┌─────────────────┐     ┌─────────────────┐              │
│   │  堆: User对象    │     │  堆: User对象    │              │
│   │  name = "Tom"   │     │  name = "Jerry" │              │
│   │  地址: 0x100    │     │  地址: 0x200    │              │
│   └─────────────────┘     └─────────────────┘              │
│                                                             │
│   user 仍指向 0x100，所以 user.name 还是 "Tom"              │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 易混淆的例子

```java
// String 不可变，所以表现得像基本类型
public void changeString(String s) {
    s = "new value";  // 创建新对象，不影响原引用
}

// 数组是引用类型
public void changeArray(int[] arr) {
    arr[0] = 100;  // 修改数组元素，原数组会变
}

public void replaceArray(int[] arr) {
    arr = new int[]{1, 2, 3};  // 指向新数组，原数组不变
}
```

## 面试回答

### 30秒版本

> Java **永远是按值传递**。基本类型传递的是值的拷贝，所以方法内修改不影响原值。引用类型传递的是**引用地址的拷贝**，两个引用指向同一对象，所以通过引用修改对象属性会影响原对象；但如果让形参指向新对象，则不影响实参的指向。

### 1分钟版本

> **核心结论**：Java 永远是按值传递
>
> **基本类型**：
> - 传递值的拷贝
> - 方法内修改不影响原值
>
> **引用类型**：
> - 传递的是引用地址的拷贝
> - 两个引用指向同一个堆对象
> - 修改对象属性 → 原对象会变
> - 让形参指向新对象 → 原引用不变
>
> **为什么容易混淆**：
> - 修改对象属性会影响原对象
> - 让人误以为是"传引用"
> - 实际是传了"引用的值"（地址的拷贝）
>
> **记忆口诀**：
> - 修改对象内容 → 有效
> - 改变引用指向 → 无效

---

*关联文档：[java-memory-model.md](../05-concurrency/java-memory-model.md)*
