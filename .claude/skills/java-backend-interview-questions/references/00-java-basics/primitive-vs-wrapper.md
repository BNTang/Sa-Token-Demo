# Java 中包装类型和基本类型的区别

## 八种基本类型和包装类

```
┌─────────────────────────────────────────────────────────────┐
│                    基本类型与包装类                          │
├──────────────┬──────────────┬────────────┬──────────────────┤
│   基本类型   │   包装类     │   大小     │   默认值         │
├──────────────┼──────────────┼────────────┼──────────────────┤
│   byte       │   Byte       │   1 字节   │   0              │
│   short      │   Short      │   2 字节   │   0              │
│   int        │   Integer    │   4 字节   │   0              │
│   long       │   Long       │   8 字节   │   0L             │
│   float      │   Float      │   4 字节   │   0.0f           │
│   double     │   Double     │   8 字节   │   0.0d           │
│   char       │   Character  │   2 字节   │   '\u0000'       │
│   boolean    │   Boolean    │   1 bit    │   false          │
├──────────────┴──────────────┴────────────┴──────────────────┤
│   包装类默认值: null                                         │
└─────────────────────────────────────────────────────────────┘
```

## 核心区别

```
┌─────────────────────────────────────────────────────────────┐
│                    核心区别                                  │
├──────────────────┬──────────────────┬───────────────────────┤
│   维度           │   基本类型       │   包装类型            │
├──────────────────┼──────────────────┼───────────────────────┤
│   存储位置       │ 栈（局部变量）   │ 堆                    │
│   默认值         │ 有默认值         │ null                  │
│   能否为 null    │ 不能             │ 可以                  │
│   泛型支持       │ 不支持           │ 支持                  │
│   集合使用       │ 不能             │ 可以                  │
│   内存占用       │ 小               │ 大（对象头）          │
│   性能           │ 高               │ 低（装拆箱开销）      │
└──────────────────┴──────────────────┴───────────────────────┘
```

## 自动装箱与拆箱

```java
// 自动装箱 (Autoboxing): 基本类型 → 包装类型
Integer a = 100;  // 等价于 Integer a = Integer.valueOf(100);

// 自动拆箱 (Unboxing): 包装类型 → 基本类型
int b = a;        // 等价于 int b = a.intValue();

// 运算时自动拆箱
Integer x = 10;
Integer y = 20;
int sum = x + y;  // x.intValue() + y.intValue()

// 方法调用
public void process(int value) { }
process(new Integer(100));  // 自动拆箱
```

```
┌─────────────────────────────────────────────────────────────┐
│                    装箱拆箱原理                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   装箱: Integer.valueOf(int)                                │
│   拆箱: Integer.intValue()                                  │
│                                                             │
│   Integer a = 100;                                          │
│   编译后 → Integer a = Integer.valueOf(100);                │
│                                                             │
│   int b = a;                                                │
│   编译后 → int b = a.intValue();                            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 缓存机制 ⭐重要

```java
// Integer 缓存 -128 到 127
Integer a = 127;
Integer b = 127;
System.out.println(a == b);  // true (同一个缓存对象)

Integer c = 128;
Integer d = 128;
System.out.println(c == d);  // false (新对象)
System.out.println(c.equals(d));  // true
```

```
┌─────────────────────────────────────────────────────────────┐
│                    包装类缓存范围                            │
├──────────────────┬──────────────────────────────────────────┤
│   包装类         │   缓存范围                               │
├──────────────────┼──────────────────────────────────────────┤
│   Byte           │   -128 ~ 127 (全部)                      │
│   Short          │   -128 ~ 127                             │
│   Integer        │   -128 ~ 127 (可通过JVM参数调整上限)     │
│   Long           │   -128 ~ 127                             │
│   Character      │   0 ~ 127                                │
│   Boolean        │   TRUE, FALSE (全部)                     │
│   Float/Double   │   无缓存                                 │
└──────────────────┴──────────────────────────────────────────┘
```

```java
// Integer 缓存源码
public static Integer valueOf(int i) {
    if (i >= IntegerCache.low && i <= IntegerCache.high) {
        return IntegerCache.cache[i + (-IntegerCache.low)];
    }
    return new Integer(i);
}
```

## 常见陷阱

```java
// 陷阱 1: == 比较
Integer a = 127, b = 127;
Integer c = 128, d = 128;
System.out.println(a == b);  // true (缓存)
System.out.println(c == d);  // false (新对象) ⚠️

// 正确做法: 使用 equals
System.out.println(c.equals(d));  // true

// 陷阱 2: 拆箱 NPE
Integer num = null;
int value = num;  // NullPointerException! ⚠️

// 正确做法: 判空
int value = (num != null) ? num : 0;
// 或 Java 9+
int value = Objects.requireNonNullElse(num, 0);

// 陷阱 3: 循环中的装箱
Long sum = 0L;
for (long i = 0; i < 1000000; i++) {
    sum += i;  // 每次都装箱，性能差 ⚠️
}

// 正确做法: 使用基本类型
long sum = 0L;
for (long i = 0; i < 1000000; i++) {
    sum += i;
}
```

## 使用场景

```
┌─────────────────────────────────────────────────────────────┐
│                    使用场景建议                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   使用基本类型:                                              │
│   • 局部变量                                                │
│   • 方法参数（不需要 null 语义）                            │
│   • 性能敏感的循环                                          │
│   • 数组元素                                                │
│                                                             │
│   使用包装类型:                                              │
│   • 需要 null 表示"无值" (数据库映射)                       │
│   • 泛型 List<Integer>                                      │
│   • 作为对象属性（ORM 映射）                                │
│   • 需要调用对象方法                                        │
│                                                             │
│   POJO 类属性:                                               │
│   • 阿里规范: POJO 属性使用包装类                           │
│   • 区分"未设置"(null) 和"值为0"                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 面试回答

### 30秒版本

> **基本类型**存栈上，有默认值，不能为 null，性能高。**包装类型**存堆上，可为 null，支持泛型和集合，有装拆箱开销。自动装箱用 `valueOf()`，有缓存（Integer -128~127）。陷阱：缓存范围外 == 比较是 false；拆箱时可能 NPE；循环中装箱影响性能。POJO 属性推荐用包装类。

### 1分钟版本

> **区别**：
> - 基本类型：栈、有默认值、不能 null
> - 包装类型：堆、可 null、支持泛型
>
> **自动装拆箱**：
> - 装箱：`Integer.valueOf()`
> - 拆箱：`Integer.intValue()`
>
> **缓存机制**：
> - Integer: -128~127
> - Byte/Short/Long 类似
> - Float/Double 无缓存
>
> **常见陷阱**：
> - == 比较：超出缓存范围是 false
> - 拆箱 NPE：null 拆箱报错
> - 循环装箱：性能问题
>
> **使用建议**：
> - 局部变量/循环：基本类型
> - POJO 属性：包装类型
> - 需要 null 语义：包装类型

---

*关联文档：[java-memory-model.md](../05-concurrency/java-memory-model.md) | [equals-hashcode.md](equals-hashcode.md)*
