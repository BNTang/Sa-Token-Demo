# TCP 和 UDP 有什么区别？

## 核心区别

```
┌─────────────────────────────────────────────────────────────┐
│                    TCP vs UDP                               │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   TCP (Transmission Control Protocol)                       │
│   ├── 面向连接                                              │
│   ├── 可靠传输                                              │
│   ├── 有序交付                                              │
│   ├── 流量控制                                              │
│   └── 拥塞控制                                              │
│                                                             │
│   UDP (User Datagram Protocol)                              │
│   ├── 无连接                                                │
│   ├── 不可靠传输                                            │
│   ├── 无序交付                                              │
│   ├── 无流量控制                                            │
│   └── 无拥塞控制                                            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 详细对比

```
┌─────────────────────────────────────────────────────────────┐
│                    特性对比                                  │
├────────────────┬─────────────────┬──────────────────────────┤
│   特性          │     TCP         │        UDP               │
├────────────────┼─────────────────┼──────────────────────────┤
│   连接方式      │  面向连接       │    无连接                │
│   可靠性        │  可靠传输       │    不可靠                │
│   顺序保证      │  保证顺序       │    不保证                │
│   传输方式      │  字节流         │    数据报                │
│   速度          │  较慢           │    快                    │
│   头部开销      │  20-60 字节     │    8 字节                │
│   拥塞控制      │  有             │    无                    │
│   流量控制      │  有             │    无                    │
│   适用场景      │  文件传输、HTTP │    视频、DNS、游戏       │
├────────────────┴─────────────────┴──────────────────────────┤
│                                                             │
│   一句话总结：                                               │
│   TCP = 可靠但慢（打电话）                                  │
│   UDP = 快速但不可靠（发短信）                              │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## TCP 工作原理

```
┌─────────────────────────────────────────────────────────────┐
│                    TCP 连接过程                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   三次握手建立连接:                                          │
│   ┌────────┐                           ┌────────┐          │
│   │ Client │                           │ Server │          │
│   └───┬────┘                           └────┬───┘          │
│       │                                     │               │
│       │ ─────── SYN (seq=x) ───────────→   │               │
│       │                                     │               │
│       │ ←───── SYN+ACK (seq=y, ack=x+1) ── │               │
│       │                                     │               │
│       │ ─────── ACK (ack=y+1) ──────────→  │               │
│       │                                     │               │
│       │         [连接建立成功]               │               │
│                                                             │
│   四次挥手断开连接:                                          │
│       │ ─────── FIN ───────────────────→   │               │
│       │ ←─────── ACK ──────────────────    │               │
│       │ ←─────── FIN ──────────────────    │               │
│       │ ─────── ACK ───────────────────→   │               │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## UDP 工作原理

```
┌─────────────────────────────────────────────────────────────┐
│                    UDP 传输过程                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   无连接，直接发送:                                          │
│   ┌────────┐                           ┌────────┐          │
│   │ Client │                           │ Server │          │
│   └───┬────┘                           └────┬───┘          │
│       │                                     │               │
│       │ ─────── Data1 ─────────────────→   │               │
│       │ ─────── Data2 ─────────────────→   │               │
│       │ ─────── Data3 ─────────────────→   │               │
│       │                                     │               │
│       │   (无需建立连接，直接发送)           │               │
│       │   (不保证到达，不保证顺序)           │               │
│                                                             │
│   UDP 报文格式:                                              │
│   ┌────────────┬────────────┬────────────┬────────────┐    │
│   │  源端口    │  目的端口   │   长度     │   校验和   │    │
│   │  (2字节)   │  (2字节)    │  (2字节)   │  (2字节)   │    │
│   └────────────┴────────────┴────────────┴────────────┘    │
│   │                    数据部分                         │    │
│   └────────────────────────────────────────────────────┘    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 应用场景

```
┌─────────────────────────────────────────────────────────────┐
│                    应用场景                                  │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   TCP 适用场景:                                              │
│   ┌─────────────────────────────────────────────────────┐  │
│   │  • HTTP/HTTPS - 网页浏览                            │  │
│   │  • FTP - 文件传输                                   │  │
│   │  • SMTP/POP3 - 邮件                                 │  │
│   │  • SSH - 远程登录                                   │  │
│   │  • MySQL 协议 - 数据库连接                          │  │
│   │  • RPC 调用 - 服务间通信                            │  │
│   │                                                     │  │
│   │  特点: 数据完整性要求高，丢包不可接受               │  │
│   └─────────────────────────────────────────────────────┘  │
│                                                             │
│   UDP 适用场景:                                              │
│   ┌─────────────────────────────────────────────────────┐  │
│   │  • DNS - 域名解析                                   │  │
│   │  • DHCP - 动态IP分配                                │  │
│   │  • 视频直播 - 实时性优先                            │  │
│   │  • 在线游戏 - 低延迟要求                            │  │
│   │  • VoIP - 语音通话                                  │  │
│   │  • QUIC/HTTP3 - 基于UDP实现可靠传输                 │  │
│   │                                                     │  │
│   │  特点: 实时性要求高，偶尔丢包可接受                 │  │
│   └─────────────────────────────────────────────────────┘  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 代码示例

```java
// TCP 客户端示例
public class TcpClient {
    public void connect() throws IOException {
        try (Socket socket = new Socket("localhost", 8080)) {
            // TCP 需要建立连接
            OutputStream out = socket.getOutputStream();
            InputStream in = socket.getInputStream();
            
            out.write("Hello TCP".getBytes());
            out.flush();
            
            byte[] buffer = new byte[1024];
            int len = in.read(buffer);
            System.out.println(new String(buffer, 0, len));
        }
    }
}

// UDP 客户端示例
public class UdpClient {
    public void send() throws IOException {
        try (DatagramSocket socket = new DatagramSocket()) {
            // UDP 无需建立连接，直接发送
            byte[] data = "Hello UDP".getBytes();
            InetAddress address = InetAddress.getByName("localhost");
            
            DatagramPacket packet = new DatagramPacket(
                data, data.length, address, 8080);
            socket.send(packet);
            
            // 接收响应
            byte[] buffer = new byte[1024];
            DatagramPacket response = new DatagramPacket(buffer, buffer.length);
            socket.receive(response);
            System.out.println(new String(response.getData(), 0, response.getLength()));
        }
    }
}
```

## 面试回答

### 30秒版本

> TCP 和 UDP 的核心区别：**TCP** 面向连接、可靠传输、保证顺序，有三次握手四次挥手，适合 HTTP、文件传输；**UDP** 无连接、不可靠、速度快、头部开销小(8字节)，适合视频直播、DNS、游戏。一句话：TCP 像打电话，UDP 像发短信。

### 1分钟版本

> **TCP 特点**：
> - 面向连接：三次握手建立，四次挥手断开
> - 可靠传输：ACK确认、超时重传、滑动窗口
> - 有序交付：序列号保证顺序
> - 流量控制 + 拥塞控制
> - 头部开销大（20-60字节）
> - 场景：HTTP、FTP、数据库连接
>
> **UDP 特点**：
> - 无连接：直接发送，不需要建立连接
> - 不可靠：不保证到达、不保证顺序
> - 速度快：无拥塞控制
> - 头部开销小（8字节）
> - 场景：DNS、视频直播、在线游戏、VoIP
>
> **选择标准**：
> - 数据完整性重要 → TCP
> - 实时性重要 → UDP

---

*关联文档：[tcp-connection.md](tcp-connection.md) | [tcp-purpose.md](tcp-purpose.md)*
