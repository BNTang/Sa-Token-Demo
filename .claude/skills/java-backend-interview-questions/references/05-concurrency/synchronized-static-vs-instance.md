# Synchronized 修饰静态方法和普通方法有什么区别？

> 分类: Java 并发 | 难度: ⭐⭐⭐ | 频率: 高频

---

## 一、核心区别

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│               synchronized 修饰静态方法 vs 普通方法                               │
├──────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│   ┌────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                            │ │
│   │   静态方法 (static)                   普通方法 (实例方法)                  │ │
│   │   ┌─────────────────────┐            ┌─────────────────────┐              │ │
│   │   │ 锁对象: Class 对象  │            │ 锁对象: this 实例   │              │ │
│   │   │ (MyClass.class)     │            │ (当前对象)          │              │ │
│   │   └─────────────────────┘            └─────────────────────┘              │ │
│   │                                                                            │ │
│   │   锁范围: 类级别                      锁范围: 实例级别                     │ │
│   │   所有实例共享同一把锁                不同实例有不同的锁                   │ │
│   │                                                                            │ │
│   └────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                  │
└──────────────────────────────────────────────────────────────────────────────────┘
```

---

## 二、代码对比

```java
public class SyncExample {
    
    // =============== 静态方法 ===============
    // 锁对象: SyncExample.class
    public static synchronized void staticMethod() {
        System.out.println("静态同步方法");
    }
    
    // 等价于:
    public static void staticMethodEquivalent() {
        synchronized (SyncExample.class) {
            System.out.println("静态同步方法");
        }
    }
    
    // =============== 普通方法 ===============
    // 锁对象: this (当前实例)
    public synchronized void instanceMethod() {
        System.out.println("实例同步方法");
    }
    
    // 等价于:
    public void instanceMethodEquivalent() {
        synchronized (this) {
            System.out.println("实例同步方法");
        }
    }
}
```

---

## 三、锁对象图解

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│                              锁对象对比                                           │
├──────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│   静态方法锁:                                                                    │
│   ┌─────────────────────────────────────────────────────────────────────────┐   │
│   │                                                                         │   │
│   │    Thread A                Thread B                Thread C             │   │
│   │       │                       │                       │                 │   │
│   │       │    staticMethod()     │    staticMethod()     │                 │   │
│   │       │                       │                       │                 │   │
│   │       ▼                       ▼                       ▼                 │   │
│   │   ┌───────────────────────────────────────────────────────────────┐     │   │
│   │   │                   SyncExample.class                           │     │   │
│   │   │                    (唯一的类锁)                               │     │   │
│   │   └───────────────────────────────────────────────────────────────┘     │   │
│   │                                                                         │   │
│   │   所有线程竞争同一把锁 → 互斥                                           │   │
│   │                                                                         │   │
│   └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
│   实例方法锁:                                                                    │
│   ┌─────────────────────────────────────────────────────────────────────────┐   │
│   │                                                                         │   │
│   │    Thread A              Thread B               Thread C                │   │
│   │       │                     │                      │                    │   │
│   │   obj1.instanceMethod()  obj1.instanceMethod()  obj2.instanceMethod()   │   │
│   │       │                     │                      │                    │   │
│   │       ▼                     ▼                      ▼                    │   │
│   │   ┌─────────────┐      ┌─────────────┐       ┌─────────────┐            │   │
│   │   │    obj1     │      │    obj1     │       │    obj2     │            │   │
│   │   │  (实例锁)   │      │  (实例锁)   │       │  (实例锁)   │            │   │
│   │   └─────────────┘      └─────────────┘       └─────────────┘            │   │
│   │         ↑                    ↑                     │                    │   │
│   │         └────── 同一把锁 ────┘                     │                    │   │
│   │                                                    │                    │   │
│   │   A 和 B 竞争 obj1 的锁 → 互斥                     │                    │   │
│   │   C 使用 obj2 的锁 → 与 A、B 不互斥                │                    │   │
│   │                                                                         │   │
│   └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
└──────────────────────────────────────────────────────────────────────────────────┘
```

---

## 四、互斥性验证

```java
public class MutexDemo {
    
    public static synchronized void staticA() {
        System.out.println("staticA 开始");
        sleep(2000);
        System.out.println("staticA 结束");
    }
    
    public static synchronized void staticB() {
        System.out.println("staticB 开始");
        System.out.println("staticB 结束");
    }
    
    public synchronized void instanceA() {
        System.out.println("instanceA 开始");
        sleep(2000);
        System.out.println("instanceA 结束");
    }
    
    public synchronized void instanceB() {
        System.out.println("instanceB 开始");
        System.out.println("instanceB 结束");
    }
}
```

### 场景 1: 两个线程调用同一对象的不同实例方法

```java
MutexDemo obj = new MutexDemo();

new Thread(() -> obj.instanceA()).start();  // 先执行
new Thread(() -> obj.instanceB()).start();  // 等待 A 完成

// 输出:
// instanceA 开始
// (等待 2 秒)
// instanceA 结束
// instanceB 开始
// instanceB 结束

// 结论: 同一实例的实例方法互斥
```

### 场景 2: 两个线程调用不同对象的实例方法

```java
MutexDemo obj1 = new MutexDemo();
MutexDemo obj2 = new MutexDemo();

new Thread(() -> obj1.instanceA()).start();
new Thread(() -> obj2.instanceB()).start();  // 立即执行，不等待

// 输出:
// instanceA 开始
// instanceB 开始       ← 几乎同时
// instanceB 结束
// (等待)
// instanceA 结束

// 结论: 不同实例的实例方法不互斥
```

### 场景 3: 两个线程调用静态方法

```java
new Thread(() -> MutexDemo.staticA()).start();
new Thread(() -> MutexDemo.staticB()).start();  // 等待 A 完成

// 输出:
// staticA 开始
// (等待 2 秒)
// staticA 结束
// staticB 开始
// staticB 结束

// 结论: 静态方法之间互斥
```

### 场景 4: 一个线程调用静态方法，一个调用实例方法

```java
MutexDemo obj = new MutexDemo();

new Thread(() -> MutexDemo.staticA()).start();
new Thread(() -> obj.instanceB()).start();  // 立即执行，不等待

// 输出:
// staticA 开始
// instanceB 开始       ← 几乎同时
// instanceB 结束
// (等待)
// staticA 结束

// 结论: 静态方法和实例方法不互斥 (锁对象不同)
```

---

## 五、对比总结表

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│                              核心对比                                             │
├──────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│   ┌─────────────┬──────────────────────────┬──────────────────────────┐         │
│   │    特性      │       静态方法           │       普通方法           │         │
│   ├─────────────┼──────────────────────────┼──────────────────────────┤         │
│   │   锁对象    │   Class 对象             │   this 实例              │         │
│   │             │   (MyClass.class)        │   (当前对象)             │         │
│   ├─────────────┼──────────────────────────┼──────────────────────────┤         │
│   │   锁数量    │   1 个 (全局唯一)        │   N 个 (每个实例一个)    │         │
│   ├─────────────┼──────────────────────────┼──────────────────────────┤         │
│   │   互斥范围  │   所有线程               │   同一实例的线程         │         │
│   ├─────────────┼──────────────────────────┼──────────────────────────┤         │
│   │   适用场景  │   全局资源保护           │   实例资源保护           │         │
│   │             │   单例、静态变量         │   对象字段               │         │
│   ├─────────────┼──────────────────────────┼──────────────────────────┤         │
│   │   并发度    │   低 (所有人排队)        │   高 (不同对象可并行)    │         │
│   └─────────────┴──────────────────────────┴──────────────────────────┘         │
│                                                                                  │
└──────────────────────────────────────────────────────────────────────────────────┘
```

---

## 六、静态方法与实例方法的交互

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│                    静态方法与实例方法是否互斥？                                   │
├──────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│   答案: 不互斥！                                                                 │
│                                                                                  │
│   原因: 锁对象不同                                                               │
│   - 静态方法锁的是 Class 对象                                                    │
│   - 实例方法锁的是 this 对象                                                     │
│   - 两者是完全不同的对象                                                         │
│                                                                                  │
│   ┌────────────────────────────────────────────────────────────────────────┐    │
│   │                                                                        │    │
│   │   synchronized static void staticMethod()                              │    │
│   │         │                                                              │    │
│   │         ▼                                                              │    │
│   │   ┌─────────────────┐                                                  │    │
│   │   │ MyClass.class   │  ← 类锁                                          │    │
│   │   └─────────────────┘                                                  │    │
│   │                                                                        │    │
│   │   synchronized void instanceMethod()                                   │    │
│   │         │                                                              │    │
│   │         ▼                                                              │    │
│   │   ┌─────────────────┐                                                  │    │
│   │   │     this        │  ← 实例锁                                        │    │
│   │   └─────────────────┘                                                  │    │
│   │                                                                        │    │
│   │   两把不同的锁，互不影响！                                              │    │
│   │                                                                        │    │
│   └────────────────────────────────────────────────────────────────────────┘    │
│                                                                                  │
└──────────────────────────────────────────────────────────────────────────────────┘
```

---

## 七、使用场景建议

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│                              使用建议                                             │
├──────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│   使用静态方法同步:                                                              │
│   ┌────────────────────────────────────────────────────────────────────────────┐ │
│   │  ✅ 保护静态变量                                                           │ │
│   │  ✅ 实现单例模式                                                           │ │
│   │  ✅ 全局唯一资源 (如序列号生成器)                                          │ │
│   │  ✅ 工具类方法需要线程安全时                                               │ │
│   └────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                  │
│   使用实例方法同步:                                                              │
│   ┌────────────────────────────────────────────────────────────────────────────┐ │
│   │  ✅ 保护实例变量                                                           │ │
│   │  ✅ 对象级别的操作                                                         │ │
│   │  ✅ 不同对象可以并行操作                                                   │ │
│   │  ✅ 提高并发度                                                             │ │
│   └────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                  │
│   ⚠️ 注意事项:                                                                   │
│   ┌────────────────────────────────────────────────────────────────────────────┐ │
│   │  ❌ 不要混用静态锁和实例锁保护同一数据                                     │ │
│   │  ❌ 避免使用 synchronized(this) 保护静态变量                               │ │
│   │  ❌ 避免使用 synchronized(Class) 保护实例变量                              │ │
│   └────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                  │
└──────────────────────────────────────────────────────────────────────────────────┘
```

---

## 八、记忆要点

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│                              记忆口诀                                             │
├──────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│   静态锁 Class，实例锁 this                                                      │
│   静态全互斥，实例各自锁                                                          │
│   静态实例不相关，锁对象不同不互斥                                                │
│                                                                                  │
└──────────────────────────────────────────────────────────────────────────────────┘
```
